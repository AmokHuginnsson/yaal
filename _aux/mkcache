#! /bin/sh

HOST_OS_TYPE=`uname -s`

DIR_LIB=""

for arg in "${@}" ; do
	case ${arg} in
		--lib-dir=*) DIR_LIB=`echo ${arg} | sed 's;--lib-dir=;;'` ;;
		*)
			echo "unknown option: ${arg}"
		;;
	esac
done

if [ ! -z "${DIR_LIB}" ] ; then

	/bin/rm -f ${DIR_LIB}/ld.so.cache

	case "${HOST_OS_TYPE}" in
		FreeBSD)
			/sbin/ldconfig -i -f ${DIR_LIB}/ld.so.cache ${DIR_LIB}
		;;
		Linux)
			/sbin/ldconfig -f ${DIR_LIB}/ld.so.conf -C ${DIR_LIB}/ld.so.cache ${DIR_LIB} > /dev/null 2> /dev/null
		;;
		SunOS)
			/bin/crle -64 -c ${DIR_LIB}/ls.so.conf -l ${DIR_LIB}
		;;
		CYGWIN*)
			cd ${DIR_LIB}
			ls -1 cyg*.dll > dlls.txt
			/bin/rebaseall -v -p -T ./dlls.txt > /dev/null 2>&1
			/bin/rm ./dlls.txt
		;;
		Darwin)
			echo "Operating system does not support dynamic library indexing."
		;;
		*)
			echo "Unknown host operating system type!"
			exit 1
		;;
	esac
else
	echo "Core settings not set!"
	exit 1
fi

exit 0
